# AI_AUTOMATION Step Type Definition
#
# ============================================================================
# DEPRECATED: This generic AI_AUTOMATION type has been replaced by 6
# specialized AI step types. Use the appropriate specialized type instead:
#
#   - AI_CUSTOM_PROMPT  -> Custom AI tasks (analysis, classification, etc.)
#   - AI_EXTRACT        -> Extract structured data from documents/text
#   - AI_SUMMARIZE      -> Summarize documents, conversations, responses
#   - AI_TRANSCRIBE     -> Transcribe audio/video to text
#   - AI_TRANSLATE      -> Translate content between languages
#   - AI_WRITE          -> Generate written content (emails, reports, letters)
#
# See the individual YAML files in this directory for full definitions.
# This file is kept for backward compatibility with existing flows.
# ============================================================================

stepType: AI_AUTOMATION
category: AUTOMATION
displayName: "AI Automation (Legacy)"
description: "DEPRECATED - Use specialized AI types instead: AI_CUSTOM_PROMPT, AI_EXTRACT, AI_SUMMARIZE, AI_TRANSCRIBE, AI_TRANSLATE, AI_WRITE"
deprecated: true
replacedBy:
  - AI_CUSTOM_PROMPT
  - AI_EXTRACT
  - AI_SUMMARIZE
  - AI_TRANSCRIBE
  - AI_TRANSLATE
  - AI_WRITE

schema:
  fields:
    - name: title
      type: string
      required: true
      description: "What the AI automation does"

    - name: description
      type: string
      required: false
      description: "Additional context (coordinator-only)"

    - name: inputs
      type: inputRef[]
      required: false
      description: "References to prior outputs, variables, or files"

    - name: prompt
      type: string
      required: true
      description: "Instructions for the AI"

    - name: knowledge
      type: knowledgeConfig
      required: false
      description: "Optional knowledge sources to reference"

    - name: outputs
      type: outputDef[]
      required: true
      constraints:
        min: 1
      description: "What the AI produces"

    - name: visibility.coordinatorOnly
      type: boolean
      required: false
      default: true
      description: "AI automations are coordinator-only by default"

# Input reference structure
inputRefSchema:
  fields:
    - name: ref
      type: string
      required: true
      description: "Reference path (e.g., 's1_form.outputs.form.client_name')"

# Output definition structure
outputDefSchema:
  fields:
    - name: key
      type: string
      required: true
      description: "Output key (e.g., 'ai.summary')"
    - name: type
      type: enum
      required: true
      values: [TEXT, FILE, JSON]
      description: "Output data type"

# Knowledge config structure
knowledgeConfigSchema:
  fields:
    - name: sources
      type: string[]
      required: false
      description: "Knowledge source names"
    - name: mode
      type: enum
      required: false
      default: OPTIONAL
      values: [REQUIRED, OPTIONAL]

completion:
  autoCompletes: true
  noAssignee: true
  coordinatorOnly: true
  description: "AI automation runs automatically and completes on its own"

outputs:
  - name: "ai.*"
    type: dynamic
    description: "Outputs defined by the step (e.g., ai.summary, ai.extracted_data)"

validationRules:
  - rule: "prompt is not empty"
    message: "AI automation requires a prompt"
  - rule: "outputs.length >= 1"
    message: "AI automation must define at least one output"

aiGuidance:
  whenToUse: |
    DEPRECATED: Do not use AI_AUTOMATION for new flows. Instead, choose the
    most specific AI type:
    - Extracting data -> AI_EXTRACT
    - Summarizing -> AI_SUMMARIZE
    - Translating -> AI_TRANSLATE
    - Transcribing -> AI_TRANSCRIBE
    - Writing content -> AI_WRITE
    - Custom/other -> AI_CUSTOM_PROMPT

  whenNotToUse: |
    - Do not use this type for new flows
    - Migrate existing flows to specialized types when possible

  migrationGuide:
    AI_EXTRACT: "If prompt mentions 'extract', 'pull out', 'parse', or 'read from'"
    AI_SUMMARIZE: "If prompt mentions 'summarize', 'condense', 'key points', or 'brief'"
    AI_TRANSLATE: "If prompt mentions 'translate', 'convert to [language]', or 'localize'"
    AI_TRANSCRIBE: "If inputs are audio/video files or URLs"
    AI_WRITE: "If prompt mentions 'write', 'draft', 'compose', 'generate [content type]'"
    AI_CUSTOM_PROMPT: "For everything else (classify, analyze, validate, score, etc.)"
