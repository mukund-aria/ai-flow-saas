# INTEGRATION_GMAIL Step Type Definition
stepType: INTEGRATION_GMAIL
category: AUTOMATION
displayName: "Gmail"
description: "Send emails through a connected Gmail account"

schema:
  events:
    - name: SEND_EMAIL
      label: "Send Email"
      description: "Send an email from a connected Gmail account"

  fields:
    - name: title
      type: string
      required: true
      description: "Description of the Gmail action"

    - name: description
      type: string
      required: false
      description: "Additional context (coordinator-only)"

    - name: event
      type: enum
      required: true
      values: [SEND_EMAIL]
      description: "Gmail action to perform"

    - name: connectionId
      type: connectionRef
      required: true
      provider: GMAIL
      description: "Gmail OAuth connection to use"

    - name: recipients
      type: recipient[]
      required: true
      description: "To email addresses (supports DDR)"

    - name: cc
      type: recipient[]
      required: false
      description: "CC email addresses (supports DDR)"

    - name: bcc
      type: recipient[]
      required: false
      description: "BCC email addresses (supports DDR)"

    - name: subject
      type: string
      required: true
      description: "Email subject line (supports DDR)"

    - name: body
      type: richText
      required: true
      description: "Email body content (supports DDR and rich text formatting)"

    - name: attachments
      type: fileRef[]
      required: false
      description: "Files to attach (supports DDR from prior FILE_REQUEST steps)"

    - name: inputs
      type: inputRef[]
      required: false
      description: "References to data from prior steps for merge fields"

    - name: visibility.coordinatorOnly
      type: boolean
      required: false
      default: true

completion:
  autoCompletes: true
  noAssignee: true
  coordinatorOnly: true
  description: "Completes when the email is sent via Gmail API"

outputs:
  - name: "messageId"
    type: string
    description: "Gmail message ID of the sent email"

validationRules:
  - rule: "recipients.length >= 1"
    message: "At least one recipient is required"
  - rule: "subject is not empty"
    message: "Email subject is required"
  - rule: "body is not empty"
    message: "Email body is required"

aiGuidance:
  whenToUse: |
    Use INTEGRATION_GMAIL to send emails from a specific Gmail account
    (as opposed to system-generated emails). This is useful when the email
    should appear to come from a real person's Gmail address.
    Examples: send personalized client emails, forward documents, send
    confirmation emails from a team member's account.

  whenNotToUse: |
    - System/platform notifications -> use SYSTEM_EMAIL
    - No specific Gmail sender needed -> use SYSTEM_EMAIL
    - Need to receive/read emails -> use GMAIL trigger instead

  seQuestions:
    - "Who should the email be sent to?"
    - "What should the email subject and body say?"
    - "Should any files from the flow be attached?"
    - "Which Gmail account should send the email?"

  defaults:
    - "SEND_EMAIL event"
    - "No attachments"
    - "No CC/BCC"
    - "Coordinator-only visibility"

  examples:
    - trigger: "send Gmail"
      mapsTo: INTEGRATION_GMAIL
    - trigger: "email from Gmail"
      mapsTo: INTEGRATION_GMAIL
    - trigger: "send via Gmail"
      mapsTo: INTEGRATION_GMAIL
    - trigger: "Gmail notification"
      mapsTo: INTEGRATION_GMAIL
