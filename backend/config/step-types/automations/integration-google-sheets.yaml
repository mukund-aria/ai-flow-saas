# INTEGRATION_GOOGLE_SHEETS Step Type Definition
stepType: INTEGRATION_GOOGLE_SHEETS
category: AUTOMATION
displayName: "Google Sheets"
description: "Add rows or columns to Google Sheets spreadsheets"

schema:
  events:
    - name: CREATE_ROW
      label: "Create Row"
      description: "Append a new row to a Google Sheets worksheet"
    - name: CREATE_COLUMN
      label: "Create Column"
      description: "Add a new column to a Google Sheets worksheet"

  fields:
    - name: title
      type: string
      required: true
      description: "Description of the Google Sheets action"

    - name: description
      type: string
      required: false
      description: "Additional context (coordinator-only)"

    - name: event
      type: enum
      required: true
      values: [CREATE_ROW, CREATE_COLUMN]
      description: "Google Sheets action to perform"

    - name: connectionId
      type: connectionRef
      required: true
      provider: GOOGLE_SHEETS
      description: "Google Sheets OAuth connection to use"

    - name: spreadsheet
      type: dynamicSelect
      required: true
      source: "googleSheets.spreadsheets"
      description: "Google Sheets spreadsheet to use"

    - name: worksheet
      type: dynamicSelect
      required: true
      source: "googleSheets.worksheets"
      dependsOn: [spreadsheet]
      description: "Worksheet (tab) within the spreadsheet"

    # Fields for CREATE_ROW
    - name: columnMappings
      type: fieldMapping[]
      required: false
      source: "googleSheets.columns"
      dependsOn: [spreadsheet, worksheet]
      appliesTo: [CREATE_ROW]
      description: "Map flow data to spreadsheet columns (auto-pulled from header row)"

    # Fields for CREATE_COLUMN
    - name: columnName
      type: string
      required: false
      appliesTo: [CREATE_COLUMN]
      description: "Name for the new column header (supports DDR)"

    - name: columnValues
      type: string[]
      required: false
      appliesTo: [CREATE_COLUMN]
      description: "Initial values for the new column (supports DDR)"

    - name: inputs
      type: inputRef[]
      required: false
      description: "References to data from prior steps for column mappings"

    - name: visibility.coordinatorOnly
      type: boolean
      required: false
      default: true

completion:
  autoCompletes: true
  noAssignee: true
  coordinatorOnly: true
  description: "Completes when the Google Sheets API returns success"

outputs:
  - name: "rowIndex"
    type: number
    description: "Row index of the newly created row"
  - name: "columnName"
    type: string
    description: "Name of the newly created column"

validationRules:
  - rule: "event is not empty"
    message: "A Google Sheets event must be selected"
  - rule: "spreadsheet is not empty"
    message: "A spreadsheet must be selected"
  - rule: "worksheet is not empty"
    message: "A worksheet must be selected"
  - rule: "columnMappings.length >= 1 when event is CREATE_ROW"
    message: "At least one column mapping is required to create a row"
  - rule: "columnName is set when event is CREATE_COLUMN"
    message: "Column name is required to create a column"

aiGuidance:
  whenToUse: |
    Use INTEGRATION_GOOGLE_SHEETS to log data to or extend Google Sheets.
    Examples: log form submissions as spreadsheet rows, create tracking sheets,
    append audit data, build reports from flow outputs.

  whenNotToUse: |
    - Managing files in Google Drive -> use INTEGRATION_GOOGLE_DRIVE
    - Complex data storage -> use INTEGRATION_AIRTABLE
    - Sending data to external APIs -> use SYSTEM_WEBHOOK

  seQuestions:
    - "Which Google Sheets spreadsheet and worksheet should we write to?"
    - "Are we adding a new row of data or a new column?"
    - "What data from the flow should map to which columns?"
    - "Does the spreadsheet already have headers, or do we need to set them up?"

  defaults:
    - "CREATE_ROW event"
    - "Column mappings auto-pulled from header row"
    - "Coordinator-only visibility"

  examples:
    - trigger: "add to spreadsheet"
      mapsTo: INTEGRATION_GOOGLE_SHEETS
    - trigger: "log to Google Sheets"
      mapsTo: INTEGRATION_GOOGLE_SHEETS
    - trigger: "create spreadsheet row"
      mapsTo: INTEGRATION_GOOGLE_SHEETS
    - trigger: "update Google Sheet"
      mapsTo: INTEGRATION_GOOGLE_SHEETS
    - trigger: "track in spreadsheet"
      mapsTo: INTEGRATION_GOOGLE_SHEETS
